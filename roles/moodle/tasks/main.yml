---
# tasks file for moodle

- name: Check if Moodle archive exists
  stat: path=/tmp/moodle-3.3.4.tgz
  register: moodle_path

- name: Download Moodle archive
  get_url: dest=/tmp/ url=https://download.moodle.org/download.php/direct/stable33/moodle-3.3.4.tgz
  when: (moodle_path.stat.exists == false)

- name: Create Moodle base directory
  file: path=/var/www/html/ owner=azureadmin group=azureadmin state=directory

- name: Extract Moodle archive
  unarchive: dest=/var/www/html/moodle src=/tmp/moodle-3.3.4.tgz remote_src=yes

- name: Fix ownership of Moodle
  file: path=/var/www/html/moodle owner=azureadmin group=azureadmin state=directory recurse=yes

- name: Create moodledata directory
  file: path=/var/www/html/moodle/moodledata owner=azureadmin group=azureadmin state=directory recurse=yes
